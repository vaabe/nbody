<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>numerical integration &amp; validation</title>
    <meta name="description" content="some approaches to solving the n-body problem">
    <link href='/feed.xml' rel='alternate' type='application/atom+xml'>
    <link rel="canonical" href="/numerical-integration/">
    <link rel="manifest" href="/manifest.json">
		
		<!-- load google fonts -->
		<link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>

		<!-- critical css -->
		
		<style>*{text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-kerning:auto}html{font-family:sans-serif;font-size:16px;height:100%;width:99%}@font-face{font-family:"et-book";src:url("/fonts/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot");src:url("/fonts/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot?#iefix") format("embedded-opentype"),url("/fonts/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff") format("woff"),url("/fonts/et-book/et-book-roman-line-figures/et-book-roman-line-figures.ttf") format("truetype"),url("/fonts/et-book/et-book-roman-line-figures/et-book-roman-line-figures.svg#etbookromanosf") format("svg");font-weight:normal;font-style:normal;font-display:swap}@font-face{font-family:"et-book";src:url("/fonts/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot");src:url("/fonts/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot?#iefix") format("embedded-opentype"),url("/fonts/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff") format("woff"),url("/fonts/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.ttf") format("truetype"),url("/fonts/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.svg#etbookromanosf") format("svg");font-weight:normal;font-style:italic;font-display:swap}@font-face{font-family:"et-book";src:url("/fonts/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot");src:url("/fonts/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot?#iefix") format("embedded-opentype"),url("/fonts/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff") format("woff"),url("/fonts/et-book/et-book-bold-line-figures/et-book-bold-line-figures.ttf") format("truetype"),url("/fonts/et-book/et-book-bold-line-figures/et-book-bold-line-figures.svg#etbookromanosf") format("svg");font-weight:bold;font-style:normal;font-display:swap}@font-face{font-family:"et-book-roman-old-style";src:url("/fonts/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot");src:url("/fonts/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot?#iefix") format("embedded-opentype"),url("/fonts/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff") format("woff"),url("/fonts/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf") format("truetype"),url("/fonts/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf") format("svg");font-weight:bold;font-style:normal;font-display:swap}body{-webkit-font-smoothing:antialiased;background:#fff;color:#2c4444;counter-reset:sidenote-counter;font-family:"Lato","Gill Sans","Gill Sans MT",Calibri,sans-serif;width:70%;padding-left:15%;padding-right:15%;line-height:1.45;max-width:1200px}h1{font-weight:400;margin-top:1.0rem;margin-bottom:2.0rem;font-size:2.5rem}h2{font-style:italic;font-weight:400;margin-top:4.0rem;margin-bottom:1.2rem;font-size:1.5rem}h3{font-weight:50;font-size:1.2rem}p{position:relative}p,table,blockquote,pre,img,hr,.mini-note,ul li,ol li{box-sizing:border-box;max-width:65%}.MathJax_SVG_Display{max-width:65% !important}a{color:#2c4444;text-decoration:underline}li ul li,li ol li{max-width:100%}ul,ol{webkit-padding-start:5%;webkit-padding-end:5%}ul.content-listing{padding-top:1.0rem;padding-bottom:1.0rem;padding-left:0;font-size:1.05rem;list-style:none}.content-listing a{color:#b0409d;text-decoration:underline}li.listing{padding-bottom:0.9rem}ul.footer-links,.credits{font-size:0.8rem;list-style:none;text-align:left;margin:0 auto;text-decoration:none}ul.footer-links li{display:inline;padding:0.5rem 0.25rem}.credits{padding:0rem 0rem}.credits a{color:#2c4444;text-decoration:none}.ext-links a{color:#b0409d;text-decoration:underline}blockquote{font-style:italic;margin:0;padding:2rem 0 2rem 4rem}figure{align-items:flex-start;display:flex;margin:0;padding:0;position:relative}hr{background-color:#2c4444;border:none;height:0.8px;width:100%;margin:1rem 0 0.6rem 0}pre{font-size:80%;margin:0;padding:1rem;overflow-x:auto}code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:80%}img{height:auto;margin-right:4rem;width:100%}table{border-collapse:separate;border-spacing:1.5rem .5rem;margin:0 6rem 0 -1.5rem;text-align:left;width:100%}table th,table td{font-weight:bold;padding:0}table th:not(:first-child),table td:not(:first-child){text-align:right}table thead th{border-bottom:1px solid #111}.subtitle{font-size:1.8rem;font-style:italic}.sans{font-family:"Lato", "Gill Sans", "Gill Sans MT", Calibri, sans-serif;letter-spacing:.03em}.caps{font-variant:small-caps}.italics{font-style:italic}.marginnote,.sidenote{font-size:80%;left:calc(100% + 4rem);line-height:1.3rem;max-width:400px;padding-top:1rem;position:absolute;top:0;width:50%}.sidenote:before{content:counter(sidenote-counter) " ";font-family:et-book-roman-old-style;position:relative;top:-0.5rem;vertical-align:baseline}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after{content:counter(sidenote-counter);font-family:et-book-roman-old-style;font-size:80%;left:0.1rem;position:relative;top:-0.5rem;vertical-align:baseline}figure .marginnote,figure .sidenote{left:auto;position:relative}.mini-note{display:block;font-size:80%;font-style:italic}.epigraph{margin:4rem 0}.epigraph blockquote{font-style:italic;margin:2rem 0}footer{display:block;margin:2em 0 1em 0;font-size:14.4px;text-align:center}footer a{white-space:normal}footer span{white-space:nowrap}#page-container{position:relative;min-height:92vh}#content-wrap{padding-bottom:6.0rem}#footer{position:absolute;bottom:0;width:100%;height:6.0rem}@media (max-width: 1400px){body{width:80%;padding-left:10%;padding-right:10%}p,table,blockquote,pre,img,hr,.mini-note,ul li,ol li{max-width:65%}.MathJax_SVG_Display{max-width:65% !important}}@media (max-width: 1100px){body{width:90%;padding-left:5%;padding-right:5%}p,table,blockquote,pre,img,hr,.mini-note,ul li,ol li{max-width:65%}.MathJax_SVG_Display{max-width:65% !important}}@media (max-width: 1000px){body{padding-left:5%;padding-right:5%}p,table,blockquote,pre,img,hr,.mini-note,ul li,ol li{max-width:600px}.MathJax_SVG_Display{max-width:100% !important}figure{flex-direction:column}.marginnote,.sidenote{display:block;left:auto;margin-top:1rem;position:relative;top:auto;width:100%}}@font-face{font-family:'icomoon';src:url("/fonts/icomoon/icomoon.eot?rgwlb8");src:url("/fonts/icomoon/icomoon.eot?#iefixrgwlb8") format("embedded-opentype"),url("/fonts/icomoon/icomoon.woff?rgwlb8") format("woff"),url("/fonts/icomoon/icomoon.ttf?rgwlb8") format("truetype"),url("/fonts/icomoon/icomoon.svg?rgwlb8#icomoon") format("svg");font-weight:normal;font-style:normal}[class^="icon-"],[class*=" icon-"]{font-family:'icomoon';speak:none;font-weight:normal;font-size:0.7rem;font-variant:normal;text-transform:none;line-height:1;color:#b0409d;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-pencil:before{content:"\e600"}.icon-film:before{content:"\e60f"}.icon-calendar:before{content:"\e601"}.icon-link:before{content:"\e602"}.icon-info:before{content:"\e603"}.icon-cancel-circle:before{content:"\e604"}.icon-checkmark-circle:before{content:"\e605"}.icon-spam:before{content:"\e606"}.icon-mail:before{content:"\e607"}.icon-googleplus:before{content:"\e608"}.icon-twitter:before{content:"\e60a"}.icon-feed:before{content:"\e60b"}.icon-flickr:before{content:"\e60c"}.icon-github:before{content:"\e60d"}.icon-box-add:before{content:"\e60e"}
</style>

		<!-- mathjax configuration -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>

		<script type="text/x-mathjax-config">
					MathJax.Hub.Config({
						TeX: {
							Macros: {
								v: ["\\boldsymbol{#1}", 1], 
								dv: ["\\dot{\\boldsymbol{#1}}", 1],
								ddv: ["\\ddot{\\boldsymbol{#1}}", 1],
								hv: ["\\hat{\\boldsymbol{#1}}", 1],
								d: ["\\text{d}", 0],
								dd: ["\\frac{\\d{#1}}{\\d{#2}}", 2],
								ddd: ["\\frac{\\d^2{#1}}{\\d{#2}^2}", 2],
								pd: ["\\frac{\\partial{#1}}{\\partial{#2}}", 2], 
								pdd: ["\\frac{\\partial^2{#1}}{\\partial{#2}^2}", 2], 
								grad: ["\\boldsymbol{\\nabla}", 0], 
								div: ["\\boldsymbol{\\nabla} \\cdot", 0], 
								curl: ["\\boldsymbol{\\nabla} \\times", 0], 
								eo: ["\\epsilon_0", 0], 
								muo: ["\\mu_0", 0], 
								Lag: ["\\mathcal{L}", 0], 
								Ham: ["\\mathcal{H}", 0],
							}
						}
					});
		</script>

		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({

			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				processEscapes: true
			},
			
			jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
			
			extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],

			TeX: {
				extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js", "newcommand.js"],
				equationNumbers: {
					autoNumber: "AMS"
				}
			}

		});
		</script>
</head>
<br>

<body>

<div id="page-container">
<div id="content-wrap">

<main>

<h1>numerical integration &amp; validation</h1>

<p>The simplest numerical method to solve the <em>n</em>-body problem is using an integrator, since the equations of motion are second order ODEs that must be integrated to give the positions of the bodies. Presented in this section are a few different integrators for the gravitational $n$-body problem using Verlet and Runge-Kutta. Most of the integrators are written in C and the analysis scripts are written in R, and can be found here.</p>

<p>There are a total of 6n equations of motion to solve. The most basic methods are numerical integrators, which involve discretising the time space and using some extrapolation method to estimate the position at the next time interval. These methods are generally reliable, and easy to implement when forces are simple.</p>

<h2 id="setup">setup</h2>

<p>In Cartesian coordinates, $\v r = \v r(x,y,z)$, and there are three second order ODEs that must be integrated for each body:</p>

<p><code class="language-plaintext highlighter-rouge">6n ODEs</code></p>

<p>For n bodies there are a total of 3n second order ODEs for the whole problem. Most integrators involve transforming these equations into 6n first order equations, by defining a velocity variable $\v v$:</p>

<p>\[
\dv r = \v v 
\]</p>

<p>where $\v v = \v v(v_x, v_y, v_z)$. Equation (1) can then be written as a first order equation in the form $\dv v = f(\v r, t)$ and the solution for $\v v(t)$ can be recombined to get $\v r(t)$.</p>

<h2 id="validation-with-the-two-body-problem">validation with the two-body problem</h2>

<p>Since the two-body problem has an exact analytic solution, it is the best case to test the accuracy of a numerical method. Here is some code that returns the exact orbit coordinates of the two-body problem, as given by the analytic solution. Below is a table showing the accuracy of Verlet and RK4 integrators for the same initial conditions:</p>

<p><code class="language-plaintext highlighter-rouge">do</code></p>

<p>Below are graphs showing the energy stability of the Verlet and RK4 integrators:</p>

<p><code class="language-plaintext highlighter-rouge">do</code></p>

<h2 id="singularities">singularities</h2>

<p>Numerical integrators are completely valid most few-body simulations and yield fairly representative orbit paths. With many-body systems the dynamical complexity of the orbits is harder to model, in particular cases where there are numerical singularities (when particles get close or collide). Here is an example:</p>

<p><code class="language-plaintext highlighter-rouge">do</code></p>

<p>The rapidly oscillating orbit path following the collision is a result of the potential energy exploding as the particles collide. This can be controlled for using regularisation or allowing for non-conservative collision forces to enter the simulation code. Examples of this will be discussed in a later post.</p>




</main>

</div>

<br>
<br>
<footer id="footer">
		<hr>
		<div class="credits">
		<span><a href="https://vabeywick.media">vinu abeywick 2020</a>&nbsp; |&nbsp; <a href="https://github.com/vaabe/tufte-minimal">tufte-minimal</a></span>
		</div>  
</footer>


</div>

</body>
</html>
